# Test Execution Guide

## ğŸ“‹ Overview

This guide provides step-by-step instructions for executing regression tests on the Screenshot Tool application.

---

## ğŸ› ï¸ Prerequisites

### 1. Install Test Dependencies

```bash
cd screenshot-app/backend
pip3 install pytest pytest-asyncio httpx
```

### 2. Verify Installation

```bash
python3 -m pytest --version
```

Expected output:
```
pytest 7.x.x
```

---

## ğŸ§ª Test Suites Available

### 1. **test_regression.py** - Core Regression Tests
- **Tests:** 28 tests across 5 test classes
- **Duration:** ~5-10 minutes
- **Purpose:** Verify core functionality hasn't regressed

### 2. **test_integration.py** - Integration Tests
- **Tests:** 10 tests across 6 test classes
- **Duration:** ~3-5 minutes
- **Purpose:** Verify component integration

### 3. **run_tests.py** - Manual Test Runner
- **Tests:** 8 manual tests
- **Duration:** ~10-15 minutes
- **Purpose:** Detailed reporting with JSON output

---

## ğŸš€ Running Tests

### Option 1: Run All Regression Tests

```bash
python3 -m pytest test_regression.py -v
```

**Expected Output:**
```
test_regression.py::TestAPIEndpoints::test_root_endpoint PASSED
test_regression.py::TestAPIEndpoints::test_health_endpoint PASSED
test_regression.py::TestAPIEndpoints::test_screenshots_list_endpoint PASSED
...
======================== 28 passed in 300.00s ========================
```

### Option 2: Run Specific Test Class

```bash
# Test API endpoints only
python3 -m pytest test_regression.py::TestAPIEndpoints -v

# Test screenshot capture only
python3 -m pytest test_regression.py::TestScreenshotCapture -v

# Test browser engines only
python3 -m pytest test_regression.py::TestBrowserEngines -v
```

### Option 3: Run Integration Tests

```bash
python3 -m pytest test_integration.py -v
```

### Option 4: Run Manual Test Suite

```bash
python3 run_tests.py
```

**Expected Output:**
```
============================================================
ğŸ§ª SCREENSHOT TOOL - REGRESSION TEST SUITE
============================================================
Started: 2025-11-03 02:47:00

âœ… Viewport Capture - PASSED (8.23s)
âœ… Fullpage Capture - PASSED (12.45s)
âœ… Segmented Capture - PASSED (25.67s)
âœ… Stealth Mode - PASSED (15.34s)
âœ… Camoufox Engine - PASSED (70.12s)
âœ… Quality Check - PASSED (10.89s)
âœ… Auth State Management - PASSED (0.45s)
âœ… Error Handling - PASSED (2.34s)

============================================================
ğŸ“Š TEST SUMMARY
============================================================
Total Tests: 8
âœ… Passed: 8
âŒ Failed: 0
â­ï¸  Skipped: 0
Success Rate: 100.0%

ğŸ“„ Results saved to: test_results.json
============================================================
```

---

## ğŸ“Š Understanding Test Results

### Test Status Indicators

- âœ… **PASSED** - Test completed successfully
- âŒ **FAILED** - Test failed with error
- â­ï¸ **SKIPPED** - Test was skipped
- âš ï¸ **WARNING** - Test passed with warnings

### Common Test Failures

#### 1. Timeout Errors
```
asyncio.TimeoutError: Screenshot capture timed out
```

**Solution:**
- Increase timeout in test configuration
- Check network connectivity
- Verify browser is launching correctly

#### 2. Browser Launch Errors
```
playwright._impl._api_types.Error: Browser closed
```

**Solution:**
- Ensure Playwright browsers are installed: `playwright install chromium`
- Check system resources (memory, CPU)
- Verify no other browser instances are running

#### 3. File Not Found Errors
```
FileNotFoundError: Screenshot file not found
```

**Solution:**
- Verify screenshots directory exists
- Check file permissions
- Ensure cleanup isn't running too early

---

## ğŸ” Debugging Failed Tests

### Enable Verbose Output

```bash
python3 -m pytest test_regression.py -v -s
```

The `-s` flag shows print statements and logs.

### Run Single Test

```bash
python3 -m pytest test_regression.py::TestScreenshotCapture::test_viewport_capture -v -s
```

### Show Full Traceback

```bash
python3 -m pytest test_regression.py -v --tb=long
```

### Stop on First Failure

```bash
python3 -m pytest test_regression.py -x
```

---

## ğŸ“ Test Results Files

### test_results.json

Generated by `run_tests.py`, contains:

```json
{
  "timestamp": "2025-11-03T02:47:00",
  "total_tests": 8,
  "passed": 8,
  "failed": 0,
  "skipped": 0,
  "tests": [
    {
      "name": "Viewport Capture",
      "status": "PASS",
      "duration": 8.23,
      "error": null
    }
  ]
}
```

### pytest HTML Report (Optional)

Install pytest-html:
```bash
pip3 install pytest-html
```

Generate HTML report:
```bash
python3 -m pytest test_regression.py --html=report.html
```

---

## ğŸ¯ Test Coverage

### Check Coverage (Optional)

Install pytest-cov:
```bash
pip3 install pytest-cov
```

Run with coverage:
```bash
python3 -m pytest test_regression.py --cov=. --cov-report=html
```

View coverage report:
```bash
open htmlcov/index.html
```

---

## ğŸ”„ Continuous Testing

### Watch Mode (Optional)

Install pytest-watch:
```bash
pip3 install pytest-watch
```

Run in watch mode:
```bash
ptw test_regression.py
```

Tests will re-run automatically when files change.

---

## ğŸ“… Recommended Testing Schedule

### Before Each Commit
```bash
python3 -m pytest test_regression.py::TestAPIEndpoints -v
```

### Before Each Pull Request
```bash
python3 -m pytest test_regression.py -v
python3 -m pytest test_integration.py -v
```

### Weekly Regression Testing
```bash
python3 run_tests.py
```

### Before Each Release
```bash
# Run all tests
python3 -m pytest test_regression.py -v
python3 -m pytest test_integration.py -v
python3 run_tests.py

# Generate coverage report
python3 -m pytest test_regression.py --cov=. --cov-report=html

# Review TESTING_HISTORY.md
```

---

## ğŸ› Reporting Issues

When reporting test failures, include:

1. **Test name** - Which test failed
2. **Error message** - Full error traceback
3. **Environment** - OS, Python version, browser versions
4. **Steps to reproduce** - How to trigger the failure
5. **Expected vs Actual** - What should happen vs what happened

Example:
```
Test: test_viewport_capture
Error: asyncio.TimeoutError after 30s
Environment: macOS 14.0, Python 3.12, Chromium 119
Steps: Run `python3 -m pytest test_regression.py::TestScreenshotCapture::test_viewport_capture`
Expected: Screenshot captured in <30s
Actual: Timeout after 30s
```

---

## ğŸ“š Additional Resources

- **pytest Documentation:** https://docs.pytest.org/
- **pytest-asyncio:** https://pytest-asyncio.readthedocs.io/
- **Playwright Testing:** https://playwright.dev/python/docs/test-runners

---

**Last Updated:** 2025-11-03  
**Version:** 1.0

