# üîó Convert Network Events to cURL Commands

**Date**: 2025-11-08  
**Status**: ‚úÖ FULLY IMPLEMENTED  
**Feature**: Export network events as cURL commands for replay/testing

---

## üéØ What Is This?

Convert captured network events (API calls) into **cURL commands** that you can:
- ‚úÖ Copy and paste into terminal
- ‚úÖ Run manually to test APIs
- ‚úÖ Save to shell script
- ‚úÖ Share with team members
- ‚úÖ Debug API issues
- ‚úÖ Replay requests

---

## üìä Example

### Network Event (Captured)
```python
{
    'event': 'request',
    'type': 'xhr',
    'method': 'GET',
    'url': 'https://api.example.com/accounting/chains?limit=50',
    'headers': {
        'Authorization': 'Bearer token123',
        'Content-Type': 'application/json'
    },
    'post_data': None
}
```

### Converted to cURL
```bash
curl -X GET \
  -H 'Authorization: Bearer token123' \
  -H 'Content-Type: application/json' \
  'https://api.example.com/accounting/chains?limit=50'
```

---

## üöÄ How to Use

### Option 1: Automatic Export (During Capture)

When capturing screenshots, cURL commands are automatically printed:

```
üì° Network events captured during page load: 314
   üåê Network activity during page load (314 events):
      üìÑ Document requests: 2
      üîÑ XHR/Fetch requests: 102
      ‚ùå Failed requests: 32
      üîó cURL commands (102 API calls):
         1. curl -X GET -H 'Authorization: Bearer ...' 'https://api.example.com/...'
         2. curl -X POST -H 'Content-Type: application/json' -d '{"key":"value"}' 'https://api.example.com/...'
         3. curl -X GET -H 'Authorization: Bearer ...' 'https://api.example.com/...'
         ... and 99 more
```

### Option 2: API Endpoint

Export network events via API:

```bash
curl -X POST http://localhost:8000/api/network/export-curl \
  -H 'Content-Type: application/json' \
  -d '{
    "network_events": [
      {
        "event": "request",
        "type": "xhr",
        "method": "GET",
        "url": "https://api.example.com/data",
        "headers": {"Authorization": "Bearer token123"},
        "post_data": null
      }
    ]
  }'
```

**Response**:
```json
{
  "success": true,
  "curl_commands": [
    "curl -X GET -H 'Authorization: Bearer token123' 'https://api.example.com/data'"
  ],
  "count": 1,
  "file": "screenshots/curl_commands.sh"
}
```

### Option 3: Shell Script

The exported cURL commands are saved as a shell script:

```bash
# File: screenshots/curl_commands.sh
#!/bin/bash
# cURL commands exported from network events
# Generated by Screenshot Tool

# Request 1
curl -X GET -H 'Authorization: Bearer token123' 'https://api.example.com/accounting/chains'

# Request 2
curl -X POST -H 'Content-Type: application/json' -d '{"key":"value"}' 'https://api.example.com/data'

# Request 3
curl -X GET -H 'Authorization: Bearer token123' 'https://api.example.com/users'
```

**Run all commands**:
```bash
bash screenshots/curl_commands.sh
```

---

## üìã Data Captured in cURL

### Headers
All request headers are included:
```bash
curl -X GET \
  -H 'Authorization: Bearer token123' \
  -H 'Content-Type: application/json' \
  -H 'Accept: application/json' \
  'https://api.example.com/data'
```

### POST Data
For POST/PUT/PATCH requests, the body is included:
```bash
curl -X POST \
  -H 'Content-Type: application/json' \
  -d '{"name":"John","email":"john@example.com"}' \
  'https://api.example.com/users'
```

### Query Parameters
Query parameters are preserved in the URL:
```bash
curl -X GET \
  'https://api.example.com/data?limit=50&offset=0&sort=name'
```

---

## üéØ Use Cases

### 1. **Test API Manually**
```bash
# Copy cURL command and run in terminal
curl -X GET -H 'Authorization: Bearer token123' 'https://api.example.com/data'
```

### 2. **Debug API Issues**
```bash
# Run cURL with verbose output
curl -v -X GET -H 'Authorization: Bearer token123' 'https://api.example.com/data'
```

### 3. **Save for Later**
```bash
# Save to file
bash screenshots/curl_commands.sh > api_responses.txt
```

### 4. **Share with Team**
```bash
# Send curl_commands.sh to team members
# They can run the same API calls
```

### 5. **Automate Testing**
```bash
# Use in CI/CD pipeline
bash screenshots/curl_commands.sh
```

### 6. **Performance Testing**
```bash
# Run multiple times to test performance
for i in {1..10}; do
  bash screenshots/curl_commands.sh
done
```

---

## üîç Example: Tekion API Calls

From the 314 network events, here are some example cURL commands:

```bash
# Get accounting chains
curl -X GET \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIs...' \
  -H 'Content-Type: application/json' \
  'https://preprodapp.tekioncloud.com/api/v1/accounting/chains?limit=50&offset=0'

# Get user data
curl -X GET \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIs...' \
  'https://preprodapp.tekioncloud.com/api/v1/users'

# Create new record
curl -X POST \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIs...' \
  -H 'Content-Type: application/json' \
  -d '{"name":"New Chain","type":"accounting"}' \
  'https://preprodapp.tekioncloud.com/api/v1/accounting/chains'
```

---

## ‚ö†Ô∏è Important Notes

### 1. **Authentication Tokens**
- cURL commands include authentication headers
- Keep these commands private (they contain tokens)
- Don't share publicly

### 2. **Sensitive Data**
- POST data may contain sensitive information
- Review before sharing
- Use environment variables for tokens:

```bash
# Instead of hardcoding token
curl -X GET \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  'https://api.example.com/data'
```

### 3. **CORS Issues**
- cURL commands may work differently than browser requests
- Browser enforces CORS, cURL doesn't
- Some APIs may require specific headers

### 4. **Rate Limiting**
- Running many cURL commands quickly may hit rate limits
- Add delays between requests:

```bash
for cmd in "${commands[@]}"; do
  $cmd
  sleep 1  # Wait 1 second between requests
done
```

---

## üìä Implementation Details

### File: `screenshot-app/backend/screenshot_service.py`

**Method**: `_convert_network_events_to_curl()`
- Lines 155-193
- Converts network events to cURL commands
- Handles headers, POST data, query parameters

**Usage**: `capture_segmented()` method
- Lines 2118-2138
- Prints first 5 cURL commands
- Shows count of total API calls

### File: `screenshot-app/backend/main.py`

**Endpoint**: `POST /api/network/export-curl`
- Lines 1205-1260
- Accepts network events
- Returns cURL commands
- Saves to shell script

---

## ‚ú® Summary

**Feature**: Convert network events to cURL commands

**Use Cases**:
- Test APIs manually
- Debug issues
- Share with team
- Automate testing
- Performance testing

**Status**: ‚úÖ Fully implemented

**Next Steps**:
1. Capture network events during screenshot
2. Export as cURL commands
3. Run manually or in scripts
4. Debug and test APIs

---

## üìö Related Documents

- `NETWORK_EVENTS_EXPLAINED.md` - Network events overview
- `NETWORK_EVENTS_EXAMPLES.md` - Real-world examples
- `NETWORK_EVENTS_QUICK_REFERENCE.md` - Quick lookup

